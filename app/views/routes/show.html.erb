<!--imposto il titolo della pagina con il metodo provide.. assegno titolo a :title, qui univoco-->
<% provide :title, @route.name %>

<div class="row">
  <% if session[:errors] %>
      <div id="error_explanation">
        <div class="alert alert-error">
          Il form contiene <%= pluralize(session[:errors].count, "error") %>.
        </div>
        <ul>
          <% session[:errors].each do |message| %>
              <li>* <%= message %></li>
          <% end %>
        </ul>
      </div>
      <% session[:errors] = nil %>
  <% end %>

  <aside class="col-md-4">
    <section>
      <img class="gravatar" src="/assets/googlem.jpg" />
      <h1><%= @route.name %></h1>
    </section>
    <section>
      <div class="stats">
        <strong id="followers" class="stat statsroutes">di <%= link_to @route.user.name, @route.user %></strong>
        <%= @route.difficulty %>
      </div>
    </section>
    <section>
        <%= render 'shared/stats_routes' %>
    </section>
    <%= render 'follow_form' if signed_in? %>
  </aside>

  <div class="col-md-8">

    <div style='width: 100%;'>
      <div id="directions" style='width: 100%; height: 250px;'></div>
    </div>

    <script type="text/javascript">
        var directionsDisplay = new google.maps.DirectionsRenderer();
        var directionsService = new google.maps.DirectionsService();

        function calcRoute() {
            var origin      = new google.maps.LatLng(<%= @route.latitude %>, <%= @route.longitude %>);
            var destination = new google.maps.LatLng(<%= @route.latitude2 %>, <%= @route.longitude2 %>);
            var request = {
                origin:      origin,
                destination: destination,
                travelMode:  google.maps.TravelMode.WALKING
            };
            directionsService.route(request, function(response, status) {
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                }
            });
        }

        calcRoute();

        var handler = Gmaps.build('Google');
        handler.buildMap({ internal: {id: 'directions'}}, function(){
            directionsDisplay.setMap(handler.getMap());
        });
    </script>

    <br />
    <%= render 'shared/comment_route_form' %>
    <% if @route.comment_routes.any? %>
        <h3>Commenti (<%= @route.comment_routes.count %>)</h3>
        <ol class="posts">
            <%= render @comment_routes %>
        </ol>
        <% will_paginate @comment_routes %>
    <% end %>
  </div>
</div>